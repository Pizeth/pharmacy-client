<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pure SVG Realistic Spherical Earth (Pattern-Based Textures)</title>
    <style>
      body {
        background: #111;
        color: white;
        font-family: sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        margin: 0;
      }

      .container {
        position: relative;
        text-align: center;
      }

      #glass {
        width: 100vmin;
        height: 100vmin;
        border-radius: 50%;
        box-shadow:
          inset -20px -20px 50px rgba(0, 0, 0, 0.8),
          inset 10px 10px 20px rgba(255, 255, 255, 0.2),
          0 0 15px #000;
        overflow: hidden;
        position: relative;
        margin: 0 auto;
        background: #000;
      }

      #glass svg {
        display: block;
        width: 100%;
        height: 100%;
      }

      .controls {
        margin-top: 20px;
        background: #222;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #444;
        display: flex;
        flex-direction: column;
        gap: 10px;
        align-items: center;
      }

      label {
        display: block;
        margin-bottom: 5px;
        font-size: 0.9em;
        color: #aaa;
      }

      input[type="range"] {
        width: 300px;
        accent-color: #0077be;
      }

      button {
        background: #0077be;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
      }

      button:hover {
        background: #005fa3;
      }

      @keyframes twinkle {
        0%,
        100% {
          opacity: 0.4;
        }
        50% {
          opacity: 1;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div id="glass">
        <svg
          viewBox="0 0 100 100"
          width="100%"
          height="100%"
          preserveAspectRatio="xMidYMid slice"
        >
          <defs>
            <!-- Your custom displacement map (fixed size) -->
            <filter id="conform">
              <feImage
                href="data:image/svg+xml;charset=utf-8,%3Csvg width='400' height='400' viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3ClinearGradient id='horiz' x1='0%25' x2='100%25'%3E%3Cstop offset='0%25' stop-color='%23ff0000'/%3E%3Cstop offset='50%25' stop_ENCODING='utf-8'%3E%3Cstop offset='50%25' stop-color='%23808080'/%3E%3Cstop offset='100%25' stop-color='%23000000'/%3E%3C/linearGradient%3E%3ClinearGradient id='vertmod' y1='0%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23ffffff'/%3E%3Cstop offset='35%25' stop-color='%23404040'/%3E%3Cstop offset='65%25' stop-color='%23404040'/%3E%3Cstop offset='100%25' stop-color='%23ffffff'/%3E%3C/linearGradient%3E%3CradialGradient id='radmod' cx='50%25' cy='50%25' r='50%25'%3E%3Cstop offset='0%25' stop-color='%23404040'/%3E%3Cstop offset='100%25' stop-color='%23ffffff'/%3E%3C/radialGradient%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='url(%23horiz)'/%3E%3Crect width='100%25' height='100%25' fill='url(%23vertmod)' style='mix-blend-mode:multiply'/%3E%3Crect width='100%25' height='100%25' fill='url(%23radmod)' style='mix-blend-mode:multiply' Hö/%3E%3Crect width='100%25' height='100%25' fill='%23000080' style='mix-blend-mode:screen'/%3E%3C/svg%3E"
                x="0"
                y="0"
                width="100%"
                height="100%"
                preserveAspectRatio="none"
                result="MAP"
              />
              <feDisplacementMap
                id="dispMap"
                in="SourceGraphic"
                in2="MAP"
                scale="50"
                xChannelSelector="R"
                yChannelSelector="B"
              />
            </filter>

            <!-- Weaker clouds displacement -->
            <filter id="cloudsConform">
              <feImage
                href="data:image/svg+xml;charset=utf-8,%3Csvg width='400' height='400' viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3ClinearGradient id='horiz' x1='0%25' x2='100%25'%3E%3Cstop offset='0%25' stop-color='%23ff0000'/%3E%3Cstop offset='50%25' stop-color='%23808080'/%3E%3Cstop offset='100%25' stop-color='%23000000'/%3E%3C/linearGradient%3E%3ClinearGradient id='vertmod' y1='0%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23ffffff'/%3E%3Cstop offset='35%25' stop-color='%23404040'/%3E%3Cstop offset='65%25' stop-color='%23404040'/%3E%3Cstop offset='100%25' stop-color='%23ffffff'/%3E%3C/linearGradient%3E%3CradialGradient id='radmod' cx='50%25' cy='50%25' r='50%25'%3E%3Cstop offset='0%25' stop-color='%23404040'/%3E%3Cstop offset='100%25' stop-color='%23ffffff'/%3E%3C/radialGradient%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='url(%23horiz)'/%3E%3Crect width='100%25' height='100%25' fill='url(%23vertmod)' style='mix-blend-mode:multiply'/%3E%3Crect width='100%25' height='100%25' fill='url(%23radmod)' style='mix-blend-mode:multiply'/%3E%3Crect width='100%25' height='100%25' fill='%23000080' style='mix-blend-mode:screen'/%3E%3C/svg%3E"
                x="0"
                y="0"
                width="100%"
                height="100%"
                preserveAspectRatio="none"
                result="MAP"
              />
              <feDisplacementMap
                id="cloudDisp"
                in="SourceGraphic"
                in2="MAP"
                scale="44"
                xChannelSelector="R"
                yChannelSelector="B"
              />
            </filter>

            <!-- City lights glow -->
            <filter
              id="lightsGlow"
              x="-100%"
              y="-100%"
              width="300%"
              height="300%"
            >
              <feGaussianBlur stdDeviation="8" result="blur" />
              <feComponentTransfer in="blur" result="brighter">
                <feFuncA type="linear" slope="2" intercept="0" />
              </feComponentTransfer>
            </filter>

            <!-- Vector circle mask (perfect circular clip) -->
            <mask id="circleMask">
              <rect x="0" y="0" width="100" height="100" fill="black" />
              <circle cx="50" cy="50" r="50" fill="white" />
            </mask>

            <!-- Patterns with double-wide raster images (seamless horizontal loop) -->
            <pattern
              id="mapPattern"
              patternUnits="userSpaceOnUse"
              width="200"
              height="100"
            >
              <animate
                attributeName="x"
                from="0"
                to="200"
                dur="50s"
                repeatCount="infinite"
              />
              <image
                href="https://upload.wikimedia.org/wikipedia/commons/thumb/2/23/Blue_Marble_2002.png/3840px-Blue_Marble_2002.png"
                width="200"
                height="100"
                preserveAspectRatio="none"
              />
            </pattern>
            <pattern
              id="cloudsPattern"
              patternUnits="userSpaceOnUse"
              width="200"
              height="100"
            >
              <animate
                attributeName="x"
                from="0"
                to="200"
                dur="40s"
                repeatCount="infinite"
              />
              <image
                href="https://eoimages.gsfc.nasa.gov/images/imagerecords/57000/57752/cloud_combined_2048.jpg"
                width="200"
                height="100"
                preserveAspectRatio="none"
              />
            </pattern>
            <pattern
              id="lightsPattern"
              patternUnits="userSpaceOnUse"
              width="200"
              height="100"
            >
              <animate
                attributeName="x"
                from="0"
                to="200"
                dur="50s"
                repeatCount="infinite"
              />
              <image
                href="https://www.solarsystemscope.com/textures/download/8k_earth_nightmap.jpg"
                width="200"
                height="400"
                preserveAspectRatio="none"
              />
            </pattern>

            <!-- Lighting/atmosphere (unchanged) -->
            <radialGradient id="limbGrad">
              <stop offset="0%" stop-color="#ffffff" />
              <stop offset="100%" stop-color="#000000" stop-opacity="0.25" />
            </radialGradient>

            <radialGradient id="specGrad" cx="50%" cy="30%">
              <stop offset="0%" stop-color="#ffffff" stop-opacity="0.7" />
              <stop offset="40%" stop-color="#ffffff" stop-opacity="0.15" />
              <stop offset="100%" stop-color="#ffffff" stop-opacity="0" />
            </radialGradient>
            <filter id="specBlur"><feGaussianBlur stdDeviation="40" /></filter>

            <radialGradient id="atmoGrad">
              <stop offset="90%" stop-color="transparent" />
              <stop offset="97%" stop-color="#88ccff" stop-opacity="0.3" />
              <stop offset="100%" stop-color="#4488ff" stop-opacity="0.7" />
            </radialGradient>
            <filter id="atmoBlur" x="-50%" y="-50%" width="200%" height="200%">
              <feGaussianBlur stdDeviation="15" />
            </filter>

            <radialGradient id="nightGrad" cx="50%" cy="30%">
              <stop offset="0%" stop-color="#000000" stop-opacity="0" />
              <stop offset="85%" stop-color="#000000" stop-opacity="0" />
              <stop offset="100%" stop-color="#000000" stop-opacity="0.8" />
            </radialGradient>
            <filter id="terminatorBlur">
              <feGaussianBlur stdDeviation="60" />
            </filter>
          </defs>

          <!-- Planet layers (rects filled with patterns, masked to perfect circle) -->
          <g mask="url(#circleMask)">
            <!-- Ground -->
            <rect
              width="100"
              height="100"
              fill="url(#mapPattern)"
              filter="url(#conform)"
            />

            <!-- Clouds (screen blend + weaker displacement) -->
            <rect
              width="100"
              height="100"
              fill="url(#cloudsPattern)"
              filter="url(#cloudsConform)"
              style="mix-blend-mode: screen"
            />

            <!-- Day/night terminator -->
            <rect
              width="100"
              height="100"
              fill="url(#nightGrad)"
              filter="url(#terminatorBlur)"
              style="mix-blend-mode: multiply"
            />

            <!-- City lights (base + glow layer) -->
            <rect
              width="100"
              height="100"
              fill="url(#lightsPattern)"
              filter="url(#conform)"
              style="mix-blend-mode: screen; opacity: 0.9"
            />
            <rect
              width="100"
              height="100"
              fill="url/#lightsPattern"
              filter="url(#conform) url(#lightsGlow)"
              style="mix-blend-mode: screen; opacity: 0.6"
            />

            <!-- Fixed overlays (limb, specular) -->
            <circle
              cx="50"
              cy="50"
              r="50"
              fill="url(#limbGrad)"
              style="mix-blend-mode: multiply"
            />
            <circle
              cx="50"
              cy="50"
              r="50"
              fill="url(#specGrad)"
              filter="url(#specBlur)"
              style="mix-blend-mode: screen"
            />
          </g>

          <!-- Atmospheric halo (spills outside the mask) -->
          <circle
            cx="50"
            cy="50"
            r="50"
            fill="url(#atmoGrad)"
            filter="url(#atmoBlur)"
          />
        </svg>
      </div>

      <div class="controls">
        <div>
          <label for="scaleSlider"
            >Displacement Scale (Spherical Intensity)</label
          >
          <input
            type="range"
            id="scaleSlider"
            min="-200"
            max="200"
            value="55"
          />
          <div id="scaleVal">55</div>
        </div>
        <div>
          <label for="cloudSpeed"
            >Cloud Rotation Speed (relative to ground)</label
          >
          <input
            type="range"
            id="cloudSpeed"
            min="-2"
            max="2"
            step="0.01"
            value="0.70"
          />
          <div id="cloudSpeedVal">0.70x</div>
        </div>
        <button id="toggleAnim">Pause Rotation</button>
      </div>
    </div>

    <script>
      const slider = document.getElementById("scaleSlider");
      const cloudSpeedSlider = document.getElementById("cloudSpeed");
      const dispMap = document.getElementById("dispMap");
      const cloudDisp = document.getElementById("cloudDisp");
      const valDisplay = document.getElementById("scaleVal");
      const cloudSpeedVal = document.getElementById("cloudSpeedVal");
      const toggleBtn = document.getElementById("toggleAnim");
      const svg = document.querySelector("#glass svg");

      const mapPattern = document.getElementById("mapPattern");
      const cloudsPattern = document.getElementById("cloudsPattern");
      const lightsPattern = document.getElementById("lightsPattern");

      const tiltY = -52; // ~13% axial tilt shift in pixels (~23.4°)
      let groundOffset = -400;
      let cloudOffset = -400;
      let cloudMultiplier = 0.7;
      let isAnimating = true;

      // Initial transform
      mapPattern.setAttribute(
        "patternTransform",
        `translate(${groundOffset}, ${tiltY})`,
      );
      lightsPattern.setAttribute(
        "patternTransform",
        `translate(${groundOffset}, ${tiltY})`,
      );
      cloudsPattern.setAttribute(
        "patternTransform",
        `translate(${cloudOffset}, ${tiltY})`,
      );

      slider.addEventListener("input", (e) => {
        const val = e.target.value;
        dispMap.setAttribute("scale", val);
        cloudDisp.setAttribute("scale", Math.round(val * 0.8));
        valDisplay.textContent = val;
      });

      cloudSpeedSlider.addEventListener("input", (e) => {
        cloudMultiplier = parseFloat(e.target.value);
        cloudSpeedVal.textContent = cloudMultiplier.toFixed(2) + "x";
      });

      toggleBtn.addEventListener("click", () => {
        isAnimating = !isAnimating;
        toggleBtn.textContent = isAnimating
          ? "Pause Rotation"
          : "Resume Rotation";
      });

      // function animate() {
      //   if (isAnimating) {
      //     groundOffset += 0.6;
      //     if (groundOffset >= 0) groundOffset = -400;

      //     cloudOffset += 0.6 * cloudMultiplier;
      //     if (cloudOffset >= 0) cloudOffset = -400;

      //     mapPattern.setAttribute(
      //       "patternTransform",
      //       `translate(${groundOffset}, ${tiltY})`,
      //     );
      //     lightsPattern.setAttribute(
      //       "patternTransform",
      //       `translate(${groundOffset}, ${tiltY})`,
      //     );
      //     cloudsPattern.setAttribute(
      //       "patternTransform",
      //       `translate(${cloudOffset}, ${tiltY})`,
      //     );
      //   }
      //   requestAnimationFrame(animate);
      // }

      // requestAnimationFrame(animate);
    </script>
  </body>
</html>
